<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/px-sample-cards/blank-card.html">
<link rel="import" href="../../bower_components/px-view-header/px-view-header.html">
<link rel="import" href="../../bower_components/px-vis-timeseries/px-vis-timeseries.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="import" href="../../bower_components/paper-progress/paper-progress.html">
<link rel="import" href="../../bower_components/px-sample-cards/blank-card.html">

<dom-module id="blankpage-view">

 <template>
<!--     <px-view-header title="Blank Page" style="display: block; margin-bottom: 6px;"></px-view-header> -->
<!--     <blank-card id="myCard"> -->
<!--       An example of a blank card without any content (except for this brief description).  Replace this with the actual content for your application. -->
<!--     </blank-card> -->

<!-- 			url="https://solar-test-timeseries-service.run.aws-usw02-pr.ice.predix.io/services/windservices/getGraphData?tagName=AC_Total_S_CB" -->


<paper-material elevation="1" style="padding:10px">

		<iron-ajax id="ajaxLatestData"
			auto
			url="https://solar-test-timeseries-service.run.aws-usw02-pr.ice.predix.io/services/windservices/getGraphData?tagName=AC_Total_S_CB"
			last-response="{{data}}"
			on-response="_onResponseLatestData"
			handleAs="json">
		</iron-ajax>
			<!-- url="http://10.56.69.54:9072/services/windservices/getGraphData?tagName=AC_Total_S_CB" -->
		
<!-- <div class="heading"> -->
<!-- <img alt="" src="house.png" style="height: 20px;vertical-align: text-bottom;"> <b>TMTC-IT1 YIELD</b> -->
<!-- </div> -->

<div id="container11" style="width: 100%; height: 270px; background:#FFF; color:#000">

 	<px-vis-timeseries id="timeSeriesDataId" include-all-series="true" 
 		enable-tooltip="true" 
 		prevent-resize="true" 
 		width="680" height="180" 
 		selection-type="yAxis" 
 		register-location="none">
 	</px-vis-timeseries>
 </div> 

</paper-material>							
							
 </div> 
  </template>
  <script>
  
  var todayDate = '';//todatDate.getDate();
  var todayFlag = false;
  var todayStartDate = "";
  var calCount = 0, IrradianceVal = 0;
  var filterType="day";
  var energyArray=[];
  var selectedMarker = "";
  
    Polymer({
      is: 'blankpage-view',
      properties:{
 		  loadValue10: {
 			type: Number,
 			value : [0]
 		},
 		 loadValue20: {
 			type: Number,
 			value : [0]
 		},
 	/*  name: {type: Number},
 	graphValue: {type: Number},
 	categorieValues:{type:Array},`
 	dataValues:{type:Array} */
 	},
 	ready : function(){


 		//alert(days[date.getDay()]);
 		// Give mock data to show
//  		var arr = 
// 			[1876.8025,5431.5137,10087.698,15428.685,20844.373,26349.088,31166.508,36319.25,39776.035,44442.02,47062.855,51788.254,54679.55,56645.965,60543.992,62789.824,63823.082,66486.65,68878.76,69880.72,73201.914,72778.73,74527.81,76155.336,77767.266,78551.65,80293.69,80642.68,82127.57,84277.086,84696.8,84042.9,85692.47,85863.086,87370.61,86899.32,88890.35,89176.305,90900.47,90405.13,89828.766,90633.664,91035.84,91184.55,93395.234,92614.54,93435.05,93643.77,93770.38,94758.89,96178.96,94008.22,94313.234,95571.13,96873.3,96442.734,97697.83,98673.35,96257.17,97573.42,96820.48,97635.86,97069.49,99656.45,97935.15,100125.8,99891.88,99524.73,100710.69,99784.73,98092.79,99904.234,99669.24,99282.33,99935.61,100715.97,100278.62,98376.695,100387.93,99136.88,101989.945,99073.914,100426.69,100555.04,100411.445,100232.72,99259.27,100764.85,101335.8,100737.375,101223.43,101490.35,99803.66,99969.78,100739.945,101907.43,100786.48,102284.1,100941.73,100559.875,100130.25,98726.805,99528.664,101762.79,101291.41,98927.88,102050.17,101697.15,100107.38,101717.49,102041.22,100735.38,101114.69,101084.17,101906.99,98905.69,100230.65,99100.734,100298.445,100729.74,98517.83,100638.45,99301.484,100421.99,99359.305,98490.56,100241.07,101026.16,98902.69,100503.43,99061.4,98925.5,97950.125,99736.625,100614.72,98724.53,99523.07,100276.41,99016.62,98490.11,99610.44,98625.62,96969.39,96588.51,96700.79,98074.96,97269.484,96725.945,96043.38,96323.31,96230.02,95681.33,96859.49,97062.48,94941.1,94252.05,94149.68,93496.4];
// 			console.log(arr.length);
// 			var val = 0;
// 			for(var i=0;i<=arr.length-1;i++){
// 				val = val+arr[i];
// 			}
// 		 	console.log(val);
 		},
		_onResponseLatestData : function(data){
			var d = new Date();
      		var startDate = null, endDate = null;
      		var categories = data.detail.response.categories;
			var values = data.detail.response.values;
			
			//values = data.detail.response.valuesMap.AC_Total_S_CB;
			//var irrData = data.detail.response.valuesMap.Irradiance;
			//alert(irrData);
			var TEnergy = 0;
			var arr=[],obj={};
			
			var value=0,count=0;
			for(var t=0;t<=values.length-1;t++){
				value = value+(values[t]/1000);
				var dateInFor = new Date(d.getDate()+"/"+d.toDateString().substr(4,3)+"/"+d.getFullYear()+" "+ categories[t]);
				obj = {
						"x" : dateInFor.getTime(),
						"Power(KW)" : values[t]/1000
						//"Irradience" : irrData[t]/20
				}
				arr.push(obj);
				TEnergy = TEnergy+(values[t]/1000);
				
				if(startDate == null){
					if(values[t] != 0){
						startDate = categories[t];
					}
				}
				if(startDate !=null){
					if(values[t] == 0){
						endDate = categories[t];
					}
				}
			}
			console.log("Value : "+ value +" Count : " + values.length);
			if(endDate == null){
				endDate = categories[values.length-1];
			}
			var timeStart = new Date(d.getDate()+"/"+d.toDateString().substr(4,3)+"/"+d.getFullYear()+" "+ startDate).getHours();
			var timeEnd = new Date(d.getDate()+"/"+d.toDateString().substr(4,3)+"/"+d.getFullYear()+" "+ endDate).getHours();
			var hourDiff = timeEnd - timeStart;      
			console.log("Total Energy : "+TEnergy +" in Whats");
			
			var vals = (TEnergy.toFixed(2));
			var roundVal = Math.round(vals * 100) / 100
			//$("#dashBEnergy").text(roundVal);
			var currency = roundVal/hourDiff;
			/* console.log(currency);
			$("#mapPowerValId").text(Math.round(currency * 100) / 100).append("<sub>K&nbsp;Wh</sub>");
			var amt = currency*12;
			//alert(amt);
			$("#revenueId").text(Math.round(amt * 100) / 100).append("<sub>&#x20B9;</sub>") */
			
			//$("#registerWrap").remove();
			// data for graph
			//console.log("<<<<<<<<<<<<"+JSON.stringify(arr)+">>>>>>>>>>>>>>");
			$("#timeSeriesDataId").attr("chart-data",JSON.stringify(arr));
			 this.async(function() {
          		 console.log("Graph Service Calling..");
                   this.$.ajaxLatestData.generateRequest();
                 }, 10000);
		//if(this.loadValue10 == 0)
      		//this._trailgraph(categories,values);
      	},	

 	 		});
  </script>
</dom-module>
